# OpenShift ACM GitOps & Keycloak Setup

This repository contains the configuration for setting up GitOps using OpenShift ACM, deploying Keycloak on the Hub cluster, and a Sample App on a Managed cluster.

## Directory Structure

- `policies/`: ACM Policies to configure GitOps and deploy applications.
  - `01-gitops-operator.yaml`: Installs OpenShift GitOps Operator.
  - `02-argocd-hub.yaml`: Configures ArgoCD on Hub.
  - `03-argocd-managed.yaml`: Configures ArgoCD on Managed Cluster.
  - `04-keycloak-app.yaml`: Deploys Keycloak on Hub.
  - `05-sample-app.yaml`: Deploys Sample App on Managed Cluster.
- `charts/keycloak/`: Helm chart for Red Hat Build of Keycloak.
- `apps/sample-app/`: Manifests for the Sample App (Nginx + OAuth2 Proxy).

## Usage

1. **Apply Policies**:
   Apply the policies to your ACM Hub cluster:
   ```bash
   oc apply -f policies/
   ```

2. **Verify Deployment**:
   - Check `policies` namespace for Policy status.
   - Check `openshift-gitops` namespace on Hub and Managed clusters for ArgoCD instances.
   - Check `keycloak` namespace on Hub for Keycloak instance.
   - Check `sample-app` namespace on Managed cluster for the Sample App.

## Configuration

- **Git Repo URL**: The policies currently point to `https://github.com/nsaraiya-rh/openshift-acm-gitops-new.git`. Update this in `policies/04-keycloak-app.yaml` and `policies/05-sample-app.yaml` if your repo URL is different.
- **Keycloak Hostname**: Configured in `charts/keycloak/values.yaml`.
- **OIDC Secret**: The Sample App deployment (`apps/sample-app/deployment.yaml`) has a placeholder `REPLACE_WITH_SECRET` for the client secret. You must update this with the secret generated by Keycloak.
